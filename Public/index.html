<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Financial Intelligence â€” FIRE Dashboard</title>
  <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,600;0,700;1,400;1,600&family=JetBrains+Mono:wght@300;400;500&display=swap" rel="stylesheet" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
  <style>
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    :root {
      --bg: #0f0f0d; --surface: #191917; --surface2: #222220;
      --border: rgba(255,255,255,0.07); --border2: rgba(255,255,255,0.12);
      --gold: #d4a843; --gold-dim: rgba(212,168,67,0.15); --gold-glow: rgba(212,168,67,0.06);
      --green: #4caf82; --green-dim: rgba(76,175,130,0.12);
      --red: #e05a4e; --red-dim: rgba(224,90,78,0.12);
      --blue: #5b9bd5; --blue-dim: rgba(91,155,213,0.12);
      --purple: #9b7fe8; --purple-dim: rgba(155,127,232,0.12);
      --text: #e8e6e0; --text-dim: #888880; --text-faint: #444440;
    }
    html { scroll-behavior: smooth; }
    body { font-family: 'JetBrains Mono', monospace; background: var(--bg); color: var(--text); min-height: 100vh; font-size: 13px; }
    body::before { content:''; position:fixed; inset:0; background-image:url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.75' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)' opacity='0.04'/%3E%3C/svg%3E"); pointer-events:none; z-index:0; opacity:0.6; }

    /* NAV */
    .nav { position:fixed; top:0; left:0; right:0; z-index:100; height:56px; display:flex; align-items:center; justify-content:space-between; padding:0 28px; background:rgba(15,15,13,0.94); backdrop-filter:blur(12px); border-bottom:1px solid var(--border); }
    .nav-brand { display:flex; align-items:center; gap:14px; }
    .brand-mark { width:30px; height:30px; border:1px solid var(--gold); display:flex; align-items:center; justify-content:center; position:relative; }
    .brand-mark::before { content:''; position:absolute; inset:3px; border:1px solid rgba(212,168,67,0.3); }
    .brand-mark svg { width:13px; height:13px; stroke:var(--gold); fill:none; stroke-width:1.8; stroke-linecap:round; stroke-linejoin:round; }
    .brand-name { font-family:'Cormorant Garamond',serif; font-size:15px; font-weight:600; color:var(--text); }
    .brand-sub { font-size:9px; letter-spacing:0.22em; text-transform:uppercase; color:var(--gold); margin-top:1px; }
    .nav-center { display:flex; gap:2px; }
    .nav-tab { font-family:'JetBrains Mono',monospace; font-size:10px; letter-spacing:0.14em; text-transform:uppercase; color:var(--text-dim); padding:7px 16px; cursor:pointer; background:none; border:none; border-bottom:2px solid transparent; transition:all 0.2s; }
    .nav-tab:hover { color:var(--text); }
    .nav-tab.active { color:var(--gold); border-bottom-color:var(--gold); }
    .nav-right { display:flex; align-items:center; gap:14px; }
    .nav-badge { font-size:9px; letter-spacing:0.12em; text-transform:uppercase; color:var(--gold); background:var(--gold-dim); padding:4px 10px; border:1px solid rgba(212,168,67,0.2); }
    .btn-logout { font-family:'JetBrains Mono',monospace; font-size:9px; letter-spacing:0.14em; text-transform:uppercase; color:var(--text-dim); background:none; border:1px solid var(--border2); padding:5px 12px; cursor:pointer; transition:all 0.2s; }
    .btn-logout:hover { color:var(--red); border-color:var(--red); }

    /* LAYOUT */
    .main { position:relative; z-index:1; padding:72px 28px 52px; max-width:1440px; margin:0 auto; }
    .section { display:none; }
    .section.active { display:block; animation:reveal 0.35s ease forwards; }
    @keyframes reveal { from { opacity:0; transform:translateY(8px); } to { opacity:1; transform:translateY(0); } }

    /* PAGE HEADER */
    .pg-header { display:flex; align-items:flex-end; justify-content:space-between; margin-bottom:28px; padding-bottom:20px; border-bottom:1px solid var(--border); }
    .pg-title { font-family:'Cormorant Garamond',serif; font-size:32px; font-weight:600; color:var(--text); line-height:1; }
    .pg-sub { font-size:10px; color:var(--text-dim); margin-top:7px; letter-spacing:0.06em; }
    .pg-actions { display:flex; align-items:center; gap:10px; }
    .btn-edit { font-family:'JetBrains Mono',monospace; font-size:9px; letter-spacing:0.14em; text-transform:uppercase; padding:7px 16px; cursor:pointer; border:none; transition:all 0.2s; background:var(--surface2); color:var(--gold); border:1px solid rgba(212,168,67,0.3); }
    .btn-edit:hover { background:var(--gold-dim); }
    .btn-save { font-family:'JetBrains Mono',monospace; font-size:9px; letter-spacing:0.14em; text-transform:uppercase; padding:7px 16px; cursor:pointer; border:none; background:var(--green); color:var(--bg); transition:all 0.2s; }
    .btn-save:hover { opacity:0.88; }

    /* GRIDS */
    .g4 { display:grid; grid-template-columns:repeat(4,1fr); gap:12px; margin-bottom:12px; }
    .g3 { display:grid; grid-template-columns:repeat(3,1fr); gap:12px; margin-bottom:12px; }
    .g2 { display:grid; grid-template-columns:repeat(2,1fr); gap:12px; margin-bottom:12px; }
    .g21 { display:grid; grid-template-columns:2fr 1fr; gap:12px; margin-bottom:12px; }
    .g12 { display:grid; grid-template-columns:1fr 2fr; gap:12px; margin-bottom:12px; }
    .g31 { display:grid; grid-template-columns:3fr 1fr; gap:12px; margin-bottom:12px; }
    .mb { margin-bottom:12px; }

    /* CARDS */
    .card { background:var(--surface); border:1px solid var(--border); padding:22px 24px; position:relative; }
    .ca  { border-top:1px solid var(--gold); }
    .cag { border-top:1px solid var(--green); }
    .cab { border-top:1px solid var(--blue); }
    .cap { border-top:1px solid var(--purple); }
    .card-label { font-size:9px; letter-spacing:0.2em; text-transform:uppercase; color:var(--text-dim); margin-bottom:6px; }
    .card-title { font-family:'Cormorant Garamond',serif; font-size:15px; font-weight:600; color:var(--text); margin-bottom:4px; }
    .card-sub { font-size:9px; color:var(--text-faint); letter-spacing:0.06em; margin-bottom:18px; }

    /* KPI */
    .kpi { background:var(--surface); border:1px solid var(--border); padding:20px 22px; }
    .kpi-label { font-size:9px; letter-spacing:0.2em; text-transform:uppercase; color:var(--text-dim); margin-bottom:10px; }
    .kpi-value { font-family:'Cormorant Garamond',serif; font-size:34px; font-weight:700; line-height:1; letter-spacing:-0.5px; color:var(--text); }
    .kpi-value.gold   { color:var(--gold); }
    .kpi-value.green  { color:var(--green); }
    .kpi-value.red    { color:var(--red); }
    .kpi-value.blue   { color:var(--blue); }
    .kpi-value.purple { color:var(--purple); }
    .kpi-delta { font-size:10px; margin-top:8px; }
    .up   { color:var(--green); }
    .down { color:var(--red); }
    .dim  { color:var(--text-dim); }
    .kpi-bar { height:2px; background:var(--surface2); margin-top:14px; }
    .kpi-bar-fill { height:100%; transition:width 1.2s ease; }
    .kpi-input { font-family:'Cormorant Garamond',serif; font-size:34px; font-weight:700; line-height:1; letter-spacing:-0.5px; color:var(--text); background:transparent; border:none; outline:none; width:100%; }
    .kpi-input:not([readonly]) { border-bottom:1px dashed var(--gold); color:var(--gold); font-size:28px; }

    /* PROGRESS */
    .prog { margin-bottom:14px; }
    .prog-row { display:flex; justify-content:space-between; margin-bottom:5px; }
    .prog-name { font-size:11px; color:var(--text); }
    .prog-val  { font-size:11px; color:var(--text-dim); }
    .prog-track { height:4px; background:var(--surface2); }
    .prog-fill  { height:100%; transition:width 1.3s ease; }

    /* TABLE */
    .tbl { width:100%; border-collapse:collapse; font-size:11px; }
    .tbl th { text-align:left; font-size:8px; letter-spacing:0.2em; text-transform:uppercase; color:var(--text-faint); padding:0 0 10px; border-bottom:1px solid var(--border); font-weight:400; }
    .tbl td { padding:10px 0; border-bottom:1px solid rgba(255,255,255,0.04); vertical-align:middle; }
    .tbl tr:last-child td { border-bottom:none; }
    .tbl .pos { color:var(--green); }
    .tbl .neg { color:var(--red); }
    .tbl .muted { color:var(--text-dim); }

    /* TAG */
    .tag { display:inline-block; font-size:8px; letter-spacing:0.12em; text-transform:uppercase; padding:2px 7px; border:1px solid; }
    .tg { color:var(--gold);   border-color:rgba(212,168,67,0.4);  background:var(--gold-dim); }
    .gg { color:var(--green);  border-color:rgba(76,175,130,0.4);  background:var(--green-dim); }
    .rg { color:var(--red);    border-color:rgba(224,90,78,0.4);   background:var(--red-dim); }
    .bg { color:var(--blue);   border-color:rgba(91,155,213,0.4);  background:var(--blue-dim); }
    .pg { color:var(--purple); border-color:rgba(155,127,232,0.4); background:var(--purple-dim); }

    /* INSIGHT */
    .ins { padding:13px 17px; border-left:2px solid; margin-bottom:10px; background:var(--surface2); }
    .ins.ig { border-color:var(--gold); }
    .ins.igg { border-color:var(--green); }
    .ins.ir { border-color:var(--red); }
    .ins.ib { border-color:var(--blue); }
    .ins.ip { border-color:var(--purple); }
    .ins-h { font-size:11px; font-weight:500; color:var(--text); margin-bottom:4px; }
    .ins-p { font-size:10px; color:var(--text-dim); line-height:1.65; }

    /* FIRE METER */
    .fire-meter { position:relative; height:10px; background:linear-gradient(90deg,var(--red) 0%,var(--gold) 50%,var(--green) 85%,#27c96a 100%); margin:16px 0 8px; }
    .fire-needle { position:absolute; top:-7px; width:0; height:0; border-left:5px solid transparent; border-right:5px solid transparent; border-top:9px solid var(--text); transform:translateX(-50%); transition:left 1.5s cubic-bezier(0.34,1.56,0.64,1); }
    .fire-labels { display:flex; justify-content:space-between; font-size:8px; letter-spacing:0.1em; color:var(--text-faint); margin-top:6px; }

    /* DONUT */
    .donut-wrap { position:relative; }
    .donut-center { position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); text-align:center; pointer-events:none; }
    .donut-v { font-family:'Cormorant Garamond',serif; font-size:20px; font-weight:700; color:var(--text); }
    .donut-l { font-size:8px; letter-spacing:0.14em; text-transform:uppercase; color:var(--text-dim); margin-top:2px; }

    /* CHART */
    .chart-wrap { position:relative; width:100%; }

    /* ALLOC */
    .alloc-row { display:flex; align-items:center; gap:10px; margin-bottom:8px; }
    .alloc-dot { width:8px; height:8px; flex-shrink:0; }
    .alloc-name { font-size:10px; flex:1; color:var(--text-dim); }
    .alloc-pct { font-size:10px; color:var(--text-faint); }
    .alloc-val { font-size:10px; color:var(--text-dim); text-align:right; min-width:72px; }

    /* MILESTONE */
    .ms { margin-bottom:16px; }
    .ms-hdr { display:flex; justify-content:space-between; align-items:center; margin-bottom:6px; }
    .ms-label { font-size:10px; color:var(--text); }
    .ms-meta { font-size:9px; color:var(--text-dim); }
    .ms-track { height:6px; background:var(--surface2); }
    .ms-fill { height:100%; transition:width 1.3s ease; }

    /* EDIT BAR */
    .edit-bar { display:none; background:var(--gold-dim); border:1px solid rgba(212,168,67,0.25); border-left:3px solid var(--gold); padding:10px 18px; margin-bottom:18px; font-size:10px; color:var(--gold); letter-spacing:0.08em; align-items:center; gap:12px; }
    .edit-bar.show { display:flex; }

    /* FRAMEWORK PILLARS */
    .pillar-grid { display:grid; grid-template-columns:repeat(4,1fr); border:1px solid var(--border); margin-bottom:12px; }
    .pillar { padding:22px; border-right:1px solid var(--border); background:var(--surface); }
    .pillar:last-child { border-right:none; }
    .pillar-num { font-family:'Cormorant Garamond',serif; font-size:48px; font-weight:700; color:var(--text-faint); line-height:1; margin-bottom:10px; }
    .pillar-label { font-size:9px; letter-spacing:0.18em; text-transform:uppercase; color:var(--gold); margin-bottom:8px; }
    .pillar-desc { font-size:10px; color:var(--text-dim); line-height:1.65; }

    /* STAGGER */
    .st { opacity:0; animation:ri 0.5s ease forwards; }
    .st:nth-child(1) { animation-delay:0.04s; }
    .st:nth-child(2) { animation-delay:0.08s; }
    .st:nth-child(3) { animation-delay:0.12s; }
    .st:nth-child(4) { animation-delay:0.16s; }
    @keyframes ri { from { opacity:0; transform:translateY(10px); } to { opacity:1; transform:translateY(0); } }

    /* RESPONSIVE */
    @media(max-width:1100px) { .g4,.pillar-grid{grid-template-columns:repeat(2,1fr);} .g3{grid-template-columns:repeat(2,1fr);} .pillar:nth-child(2){border-right:none;} .pillar:nth-child(3),.pillar:nth-child(4){border-top:1px solid var(--border);} }
    @media(max-width:768px) { .main{padding:68px 16px 40px;} .nav{padding:0 16px;} .nav-center{display:none;} .g2,.g21,.g12,.g31{grid-template-columns:1fr;} .g4,.g3{grid-template-columns:1fr;} .pillar-grid{grid-template-columns:1fr;} .pillar{border-right:none;border-top:1px solid var(--border);} .pillar:first-child{border-top:none;} }

    ::-webkit-scrollbar { width:5px; }
    ::-webkit-scrollbar-track { background:var(--bg); }
    ::-webkit-scrollbar-thumb { background:var(--surface2); }
  </style>
</head>
<body>

<nav class="nav">
  <div class="nav-brand">
    <div class="brand-mark">
      <svg viewBox="0 0 24 24"><polyline points="22 7 13.5 15.5 8.5 10.5 2 17"/><polyline points="16 7 22 7 22 13"/></svg>
    </div>
    <div>
      <div class="brand-name">Financial Intelligence</div>
      <div class="brand-sub">FIRE Â· Mid-Career Â· Monarch Money</div>
    </div>
  </div>
  <div class="nav-center">
    <button class="nav-tab active" onclick="nav('overview',this)">Overview</button>
    <button class="nav-tab" onclick="nav('networth',this)">Net Worth</button>
    <button class="nav-tab" onclick="nav('budget',this)">Budget</button>
    <button class="nav-tab" onclick="nav('investments',this)">Investments</button>
    <button class="nav-tab" onclick="nav('fire',this)">FIRE</button>
    <button class="nav-tab" onclick="nav('framework',this)">Framework</button>
  </div>
  <div class="nav-right">
    <div class="nav-badge" id="navBadge">Loadingâ€¦</div>
    <div style="font-size:9px;color:var(--text-faint);letter-spacing:0.08em" id="navDate"></div>
    <button class="btn-logout" onclick="logout()">Exit</button>
  </div>
</nav>

<main class="main">

<!-- â•â•â• OVERVIEW â•â•â• -->
<div class="section active" id="sec-overview">
  <div class="pg-header">
    <div>
      <div class="pg-title">Financial Overview</div>
      <div class="pg-sub">Mid-career FIRE snapshot Â· synced from Monarch Money</div>
    </div>
    <div class="pg-actions">
      <button class="btn-edit" id="editBtn" onclick="toggleEdit()">âœŽ Edit Data</button>
      <button class="btn-save" id="saveBtn" style="display:none" onclick="saveAll()">âœ“ Save</button>
      <div style="font-size:9px;color:var(--text-faint)">Updated <span id="lastUp">â€”</span></div>
    </div>
  </div>
  <div class="edit-bar" id="editBar">âœŽ &nbsp;Edit mode active â€” click highlighted values to update with your Monarch Money data</div>

  <div class="g4 st">
    <div class="kpi ca">
      <div class="kpi-label">Net Worth</div>
      <div class="kpi-value gold">$<input class="kpi-input" id="f-netWorth" type="number" value="125000" readonly onchange="recalc()"/></div>
      <div class="kpi-delta up">â†‘ +$8,400 this quarter</div>
      <div class="kpi-bar"><div class="kpi-bar-fill" id="b-nw" style="background:var(--gold)"></div></div>
    </div>
    <div class="kpi">
      <div class="kpi-label">Monthly Income</div>
      <div class="kpi-value green">$<input class="kpi-input" id="f-income" type="number" value="7500" readonly onchange="recalc()"/></div>
      <div class="kpi-delta dim">Take-home after tax</div>
      <div class="kpi-bar"><div class="kpi-bar-fill" style="background:var(--green);width:100%"></div></div>
    </div>
    <div class="kpi">
      <div class="kpi-label">Monthly Expenses</div>
      <div class="kpi-value red">$<input class="kpi-input" id="f-expenses" type="number" value="5200" readonly onchange="recalc()"/></div>
      <div class="kpi-delta dim" id="d-expRatio">â€”</div>
      <div class="kpi-bar"><div class="kpi-bar-fill" id="b-exp" style="background:var(--red)"></div></div>
    </div>
    <div class="kpi cag">
      <div class="kpi-label">Monthly Savings</div>
      <div class="kpi-value green" id="v-sav">$2,300</div>
      <div class="kpi-delta" id="d-savRate">â€”</div>
      <div class="kpi-bar"><div class="kpi-bar-fill" id="b-sav" style="background:var(--green)"></div></div>
    </div>
  </div>

  <div class="g4 st">
    <div class="kpi">
      <div class="kpi-label">Total Assets</div>
      <div class="kpi-value gold">$<input class="kpi-input" id="f-assets" type="number" value="165000" readonly onchange="recalc()"/></div>
      <div class="kpi-delta dim">Investments + Cash + Property</div>
    </div>
    <div class="kpi">
      <div class="kpi-label">Total Liabilities</div>
      <div class="kpi-value red">$<input class="kpi-input" id="f-liabilities" type="number" value="40000" readonly onchange="recalc()"/></div>
      <div class="kpi-delta dim">All debts combined</div>
    </div>
    <div class="kpi cab">
      <div class="kpi-label">FIRE Progress</div>
      <div class="kpi-value blue" id="v-firePct">â€”</div>
      <div class="kpi-delta dim" id="d-firePct">â€”</div>
      <div class="kpi-bar"><div class="kpi-bar-fill" id="b-fire" style="background:var(--blue)"></div></div>
    </div>
    <div class="kpi cap">
      <div class="kpi-label">Years to FI</div>
      <div class="kpi-value purple" id="v-yrs">â€”</div>
      <div class="kpi-delta dim" id="d-yrs">â€”</div>
      <div class="kpi-bar"><div class="kpi-bar-fill" id="b-yrs" style="background:var(--purple)"></div></div>
    </div>
  </div>

  <div class="g21 st">
    <div class="card ca">
      <div class="card-title">Income vs. Expenses â€” 12 Months</div>
      <div class="card-sub">Monthly cash flow Â· gap = savings added to net worth</div>
      <div class="chart-wrap" style="height:210px"><canvas id="ch-ie"></canvas></div>
    </div>
    <div class="card">
      <div class="card-title">Spending Mix</div>
      <div class="card-sub">By Monarch category</div>
      <div class="donut-wrap" style="height:155px;position:relative">
        <canvas id="ch-donut"></canvas>
        <div class="donut-center"><div class="donut-v" id="donut-v">â€”</div><div class="donut-l">Monthly</div></div>
      </div>
      <div id="donut-lg" style="margin-top:10px"></div>
    </div>
  </div>

  <div class="card st mb">
    <div class="card-title">Key Insights &amp; Action Items</div>
    <div class="card-sub">Research-backed recommendations Â· updated live from your data</div>
    <div id="insights"></div>
  </div>
</div>

<!-- â•â•â• NET WORTH â•â•â• -->
<div class="section" id="sec-networth">
  <div class="pg-header"><div><div class="pg-title">Net Worth Analysis</div><div class="pg-sub">Balance sheet Â· trajectory Â· milestone tracking</div></div></div>

  <div class="g21 st">
    <div class="card ca">
      <div class="card-title">Net Worth Trajectory</div>
      <div class="card-sub">12-month history + 5-year projection at current savings rate + 7% return</div>
      <div class="chart-wrap" style="height:230px"><canvas id="ch-nwt"></canvas></div>
    </div>
    <div class="card">
      <div class="card-title">Wealth Composition</div>
      <div class="card-sub">By asset class</div>
      <div class="donut-wrap" style="height:155px;position:relative">
        <canvas id="ch-assetmix"></canvas>
        <div class="donut-center"><div class="donut-v" id="am-v">â€”</div><div class="donut-l">Assets</div></div>
      </div>
      <div id="am-lg" style="margin-top:10px"></div>
    </div>
  </div>

  <div class="g3 st">
    <div class="card">
      <div class="card-label">Stanley &amp; Danko Formula</div>
      <div class="card-title">PAW / UAW Score</div>
      <div class="card-sub">Expected NW = Age Ã— Income Ã· 10</div>
      <div id="paw"></div>
    </div>
    <div class="card">
      <div class="card-label">Federal Reserve SCF 2022</div>
      <div class="card-title">Peer Wealth Benchmark</div>
      <div class="card-sub">Net worth percentile for your age cohort</div>
      <div id="peer"></div>
    </div>
    <div class="card">
      <div class="card-label">FINRA Guidelines</div>
      <div class="card-title">Emergency Resilience</div>
      <div class="card-sub">Liquid months of expenses covered</div>
      <div id="emergency"></div>
    </div>
  </div>

  <div class="g2 st">
    <div class="card">
      <div class="card-title">Assets</div>
      <div class="card-sub">Mirror your Monarch Money accounts</div>
      <table class="tbl"><thead><tr><th>Account</th><th style="text-align:right">Value</th><th style="text-align:right">Class</th></tr></thead><tbody id="tbl-a"></tbody></table>
    </div>
    <div class="card">
      <div class="card-title">Liabilities</div>
      <div class="card-sub">Sorted by APR â€” avalanche priority order</div>
      <table class="tbl"><thead><tr><th>Debt</th><th style="text-align:right">Balance</th><th style="text-align:right">APR</th><th style="text-align:right">Priority</th></tr></thead><tbody id="tbl-l"></tbody></table>
    </div>
  </div>

  <div class="card st mb">
    <div class="card-title">Wealth Milestones</div>
    <div class="card-sub">Progress toward key FIRE checkpoints</div>
    <div id="milestones"></div>
  </div>
</div>

<!-- â•â•â• BUDGET â•â•â• -->
<div class="section" id="sec-budget">
  <div class="pg-header"><div><div class="pg-title">Budget Analysis</div><div class="pg-sub">50/30/20 Â· Monarch categories Â· savings rate optimization</div></div></div>

  <div class="g3 st">
    <div class="kpi cab">
      <div class="kpi-label">Needs (Target â‰¤50%)</div>
      <div class="kpi-value blue" id="v-needs">â€”</div>
      <div class="kpi-delta" id="d-needs">â€”</div>
      <div class="kpi-bar"><div class="kpi-bar-fill" id="b-needs" style="background:var(--blue)"></div></div>
      <div style="margin-top:10px;font-size:9px;color:var(--text-faint)">Housing Â· Utilities Â· Groceries Â· Transport Â· Healthcare</div>
    </div>
    <div class="kpi">
      <div class="kpi-label">Wants (Target â‰¤30%)</div>
      <div class="kpi-value gold" id="v-wants">â€”</div>
      <div class="kpi-delta" id="d-wants">â€”</div>
      <div class="kpi-bar"><div class="kpi-bar-fill" id="b-wants" style="background:var(--gold)"></div></div>
      <div style="margin-top:10px;font-size:9px;color:var(--text-faint)">Dining Â· Entertainment Â· Shopping Â· Subscriptions</div>
    </div>
    <div class="kpi cag">
      <div class="kpi-label">Savings + Debt (Target â‰¥20%)</div>
      <div class="kpi-value green" id="v-sav2">â€”</div>
      <div class="kpi-delta" id="d-sav2">â€”</div>
      <div class="kpi-bar"><div class="kpi-bar-fill" id="b-sav2" style="background:var(--green)"></div></div>
      <div style="margin-top:10px;font-size:9px;color:var(--text-faint)">Investments Â· Retirement Â· Savings Â· Debt Payments</div>
    </div>
  </div>

  <div class="g2 st">
    <div class="card">
      <div class="card-title">Spending by Monarch Category</div>
      <div class="card-sub">% of monthly income</div>
      <div id="cat-bars"></div>
    </div>
    <div class="card ca">
      <div class="card-title">Actual vs. 50/30/20 Target</div>
      <div class="card-sub">Your allocation vs. Warren framework</div>
      <div class="chart-wrap" style="height:190px"><canvas id="ch-5030"></canvas></div>
      <div id="budget-ins" style="margin-top:14px"></div>
    </div>
  </div>

  <div class="g2 st">
    <div class="card cag">
      <div class="card-title">10-Year Savings Projection</div>
      <div class="card-sub">7% annualized return (S&amp;P 500 historical avg) Â· FIRE target line</div>
      <div class="chart-wrap" style="height:195px"><canvas id="ch-proj"></canvas></div>
    </div>
    <div class="card">
      <div class="card-title">Savings Rate Optimization</div>
      <div class="card-sub">What each incremental 5% boost is worth</div>
      <div id="sav-sc"></div>
    </div>
  </div>
</div>

<!-- â•â•â• INVESTMENTS â•â•â• -->
<div class="section" id="sec-investments">
  <div class="pg-header"><div><div class="pg-title">Investment Allocation</div><div class="pg-sub">Portfolio composition Â· tax efficiency Â· Bogle three-fund framework</div></div></div>

  <div class="g4 st">
    <div class="kpi cap">
      <div class="kpi-label">Investment Portfolio</div>
      <div class="kpi-value purple" id="v-portTot">â€”</div>
      <div class="kpi-delta dim" id="d-portPct">â€”</div>
    </div>
    <div class="kpi">
      <div class="kpi-label">Retirement Accounts</div>
      <div class="kpi-value gold" id="v-ret">â€”</div>
      <div class="kpi-delta dim" id="d-retPct">401(k) + IRA</div>
    </div>
    <div class="kpi">
      <div class="kpi-label">Taxable Brokerage</div>
      <div class="kpi-value blue" id="v-tax">â€”</div>
      <div class="kpi-delta dim">After-tax investments</div>
    </div>
    <div class="kpi cag">
      <div class="kpi-label">Annual Contribution</div>
      <div class="kpi-value green" id="v-contrib">â€”</div>
      <div class="kpi-delta dim" id="d-contrib">â€”</div>
    </div>
  </div>

  <div class="g2 st">
    <div class="card">
      <div class="card-title">Portfolio Breakdown</div>
      <div class="card-sub">Three-fund model Â· enter actual holdings</div>
      <div style="display:flex;gap:20px;align-items:flex-start">
        <div class="donut-wrap" style="width:155px;height:155px;flex-shrink:0;position:relative">
          <canvas id="ch-port"></canvas>
          <div class="donut-center"><div class="donut-v" id="port-v">â€”</div><div class="donut-l">Invested</div></div>
        </div>
        <div id="alloc-lg" style="flex:1;margin-top:8px"></div>
      </div>
    </div>
    <div class="card cap">
      <div class="card-title">Tax Efficiency Ladder</div>
      <div class="card-sub">Optimal account prioritization (Bogle / Ferri framework)</div>
      <div id="tax-eff"></div>
    </div>
  </div>

  <div class="g2 st">
    <div class="card">
      <div class="card-title">Stocks / Bonds / Other Split</div>
      <div class="card-sub">Target: 110 âˆ’ age in equities (FIRE-adjusted)</div>
      <div class="chart-wrap" style="height:175px"><canvas id="ch-sb"></canvas></div>
      <div id="sb-ins" style="margin-top:14px"></div>
    </div>
    <div class="card ca">
      <div class="card-title">Contribution Limits 2024</div>
      <div class="card-sub">Are you leaving tax-advantaged space unused?</div>
      <div id="contrib-lim"></div>
    </div>
  </div>

  <div class="card st mb">
    <div class="card-title">Investment Action Items</div>
    <div class="card-sub">Priority-ranked recommendations for your portfolio</div>
    <div id="inv-ins"></div>
  </div>
</div>

<!-- â•â•â• FIRE â•â•â• -->
<div class="section" id="sec-fire">
  <div class="pg-header"><div><div class="pg-title">FIRE Calculator</div><div class="pg-sub">Financial Independence Â· 4% rule Â· Bengen 1994 Â· Scenario modeling</div></div></div>

  <div class="g31 st">
    <div class="card ca">
      <div class="card-title">FIRE Number &amp; Progress</div>
      <div class="card-sub">25Ã— annual expenses Â· Bengen Safe Withdrawal Rate</div>
      <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:12px;margin-bottom:22px" id="fire-kpis"></div>
      <div style="font-size:9px;letter-spacing:0.16em;text-transform:uppercase;color:var(--text-faint);margin-bottom:8px">FIRE PROGRESS METER</div>
      <div class="fire-meter"><div class="fire-needle" id="fire-needle" style="left:2%"></div></div>
      <div class="fire-labels"><span>0%</span><span>25%</span><span>50%</span><span>75%</span><span>FI ðŸ”¥</span></div>
    </div>
    <div class="card">
      <div class="card-title">Assumptions</div>
      <div class="card-sub">Edit to model your scenario</div>
      <div id="fire-assumptions"></div>
    </div>
  </div>

  <div class="card st mb">
    <div class="card-title">Scenario Modeling â€” Net Worth to FIRE</div>
    <div class="card-sub">How savings rate changes accelerate your timeline Â· 7% real return</div>
    <div class="chart-wrap" style="height:255px"><canvas id="ch-fire"></canvas></div>
  </div>

  <div class="g3 st">
    <div class="card">
      <div class="card-title">FIRE Variants</div>
      <div class="card-sub">Which flavor matches your goals?</div>
      <div id="fire-variants"></div>
    </div>
    <div class="card cag">
      <div class="card-title">Lean FIRE</div>
      <div class="card-sub">Reduced expenses Â· earliest exit</div>
      <div id="lean-fire"></div>
    </div>
    <div class="card ca">
      <div class="card-title">Fat FIRE</div>
      <div class="card-sub">Elevated lifestyle Â· maximum cushion</div>
      <div id="fat-fire"></div>
    </div>
  </div>
</div>

<!-- â•â•â• FRAMEWORK â•â•â• -->
<div class="section" id="sec-framework">
  <div class="pg-header"><div><div class="pg-title">Analysis Framework</div><div class="pg-sub">Research methodology Â· academic citations Â· FIRE-specific models</div></div></div>

  <div class="pillar-grid st">
    <div class="pillar"><div class="pillar-num">01</div><div class="pillar-label">Net Worth Tracking</div><div class="pillar-desc">Balance sheet method: assets âˆ’ liabilities monthly. Benchmarked via Stanley & Danko PAW formula (Age Ã— Income Ã· 10). Mid-career target: 15â€“25% YoY net worth growth.</div></div>
    <div class="pillar"><div class="pillar-num">02</div><div class="pillar-label">Cash Flow Optimization</div><div class="pillar-desc">50/30/20 rule (Warren & Tyagi) for category allocation. Savings rate is the #1 lever for FIRE timeline. Each 5% improvement shaves years off your date â€” modeled live in the scenario chart.</div></div>
    <div class="pillar"><div class="pillar-num">03</div><div class="pillar-label">Investment Allocation</div><div class="pillar-desc">Three-fund portfolio (Bogle): US Total Market + International + Bonds. Age-based equity target: 110 âˆ’ age. Tax-location strategy (Ferri): bonds in tax-deferred, equities in taxable/Roth.</div></div>
    <div class="pillar"><div class="pillar-num">04</div><div class="pillar-label">FIRE Modeling</div><div class="pillar-desc">Bengen's 4% SWR (1994). Confirmed by Trinity Study (1998). FIRE number = 25Ã— annual expenses. Multiple variants: Lean (20Ã—), Regular (25Ã—), Fat (33Ã—), Coast, Barista â€” all modeled.</div></div>
  </div>
  <div class="pillar-grid st" style="margin-top:0">
    <div class="pillar"><div class="pillar-num">05</div><div class="pillar-label">Debt Prioritization</div><div class="pillar-desc">Avalanche method: target highest-APR debt first (mathematical optimum). Every dollar above the minimum on a 22% card earns a guaranteed 22% return â€” better than any investment.</div></div>
    <div class="pillar"><div class="pillar-num">06</div><div class="pillar-label">Tax Efficiency</div><div class="pillar-desc">Priority order: 401(k) match â†’ HSA â†’ Roth IRA â†’ 401(k) max â†’ taxable. Tax-advantaged space is your most powerful wealth accelerator â€” never leave match money on the table.</div></div>
    <div class="pillar"><div class="pillar-num">07</div><div class="pillar-label">Behavioral Finance</div><div class="pillar-desc">Thaler & Sunstein nudge theory: automate savings to remove decision friction. Monarch Money category tracking operationalizes Drucker's "what you measure, you manage."</div></div>
    <div class="pillar"><div class="pillar-num">08</div><div class="pillar-label">Monarch Integration</div><div class="pillar-desc">Dashboard mirrors Monarch Money's category taxonomy. Manual sync workflow. Future: Monarch CSV export maps directly to all fields. Each section labeled with its Monarch equivalent.</div></div>
  </div>

  <div class="card st mb">
    <div class="card-title">Academic &amp; Professional Citations</div>
    <div class="card-sub">Every metric and recommendation in this dashboard is sourced below</div>
    <table class="tbl">
      <thead><tr><th>Concept</th><th>Source</th><th>Year</th><th>Application Here</th></tr></thead>
      <tbody>
        <tr><td>4% Safe Withdrawal Rate</td><td class="muted">Bengen Â· Journal of Financial Planning</td><td class="muted">1994</td><td>FIRE number = 25Ã— expenses</td></tr>
        <tr><td>Trinity Study SWR Validation</td><td class="muted">Cooley, Hubbard, Walz Â· AAII Journal</td><td class="muted">1998</td><td>Confirms 4% across 30-year horizons</td></tr>
        <tr><td>50/30/20 Budget Rule</td><td class="muted">Warren & Tyagi Â· All Your Worth</td><td class="muted">2005</td><td>Budget category targets</td></tr>
        <tr><td>PAW / UAW Net Worth Model</td><td class="muted">Stanley & Danko Â· The Millionaire Next Door</td><td class="muted">1996</td><td>Wealth adequacy benchmarking</td></tr>
        <tr><td>Index Fund / Three-Fund Portfolio</td><td class="muted">Bogle Â· The Little Book of Common Sense Investing</td><td class="muted">2007</td><td>Investment framework</td></tr>
        <tr><td>Tax-Efficient Fund Placement</td><td class="muted">Ferri Â· All About Asset Allocation</td><td class="muted">2010</td><td>Tax-location strategy</td></tr>
        <tr><td>Nudge / Behavioral Finance</td><td class="muted">Thaler & Sunstein Â· Nudge</td><td class="muted">2008</td><td>Automation & savings psychology</td></tr>
        <tr><td>DTI Thresholds</td><td class="muted">Consumer Financial Protection Bureau</td><td class="muted">Ongoing</td><td>Debt health (â‰¤36%)</td></tr>
        <tr><td>Emergency Fund Adequacy</td><td class="muted">FINRA Investor Education Foundation</td><td class="muted">Ongoing</td><td>Liquidity: 3â€“6 months</td></tr>
      </tbody>
    </table>
  </div>
</div>

</main>

<script>
// â”€â”€â”€ DATA â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
let D = {
  netWorth:165000-40000, monthlyIncome:7500, monthlyExpenses:5200,
  totalAssets:165000, totalLiabilities:40000,
  emergencyFund:18500, monthlyDebt:850, age:35, grossIncome:120000,
  fireReturn:7.0, fireWithdrawal:4.0,
  assets:[
    {name:'401(k)',        value:45000, cls:'Retirement'},
    {name:'Roth IRA',      value:17000, cls:'Retirement'},
    {name:'Brokerage',     value:28000, cls:'Taxable'},
    {name:'HYSA',          value:18500, cls:'Cash'},
    {name:'Checking',      value:4500,  cls:'Cash'},
    {name:'Home Equity',   value:48000, cls:'Property'},
    {name:'Crypto/Other',  value:4000,  cls:'Alt'},
  ],
  liabilities:[
    {name:'Credit Card',  balance:3200,  rate:22.99},
    {name:'Student Loan', balance:22000, rate:5.50},
    {name:'Auto Loan',    balance:8800,  rate:6.90},
    {name:'Other',        balance:6000,  rate:8.00},
  ],
  portfolio:[
    {label:'US Stocks',      value:55000, color:'#5b9bd5'},
    {label:'International',  value:18000, color:'#9b7fe8'},
    {label:'Bonds',          value:12000, color:'#d4a843'},
    {label:'REITs',          value:5000,  color:'#4caf82'},
  ],
  spending:[
    {cat:'Housing',       amt:1800, color:'#5b9bd5', type:'need'},
    {cat:'Groceries',     amt:420,  color:'#4caf82', type:'need'},
    {cat:'Transport',     amt:380,  color:'#9b7fe8', type:'need'},
    {cat:'Utilities',     amt:160,  color:'#d4a843', type:'need'},
    {cat:'Healthcare',    amt:100,  color:'#e05a4e', type:'need'},
    {cat:'Dining Out',    amt:420,  color:'#e8834a', type:'want'},
    {cat:'Entertainment', amt:180,  color:'#6ecb8a', type:'want'},
    {cat:'Shopping',      amt:280,  color:'#a87fd4', type:'want'},
    {cat:'Subscriptions', amt:85,   color:'#7a9fc0', type:'want'},
    {cat:'Personal Care', amt:120,  color:'#c09a5a', type:'want'},
    {cat:'Misc',          amt:255,  color:'#555550', type:'want'},
  ],
  nwHistory:[58000,67000,72000,78000,85000,91000,98000,104000,109000,116000,120000,125000],
  incHistory:[7200,7200,7500,7500,7200,7500,7500,7800,7500,7500,7500,7500],
  expHistory:[5100,4800,5400,5200,4900,5300,5500,5100,5200,5400,4950,5200],
};

let editMode=false, charts={};
const MOS=['Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec','Jan'];
const ACLS={Retirement:'#d4a843',Taxable:'#5b9bd5',Cash:'#4caf82',Property:'#9b7fe8',Alt:'#e05a4e'};
const CD={plugins:{legend:{display:false},tooltip:{backgroundColor:'#1a1a18',titleColor:'#d4a843',bodyColor:'#c8c6c0',padding:12,cornerRadius:0,titleFont:{family:'JetBrains Mono',size:10},bodyFont:{family:'JetBrains Mono',size:11}}}};

document.addEventListener('DOMContentLoaded',()=>{
  try{const s=localStorage.getItem('fd3');if(s)D=JSON.parse(s);}catch(e){}
  const now=new Date();
  document.getElementById('navDate').textContent=now.toLocaleDateString('en-US',{month:'short',day:'numeric',year:'numeric'});
  document.getElementById('lastUp').textContent=now.toLocaleDateString('en-US',{month:'short',day:'numeric'});
  syncInputs(); recalc(); renderAll();
  drawIE(); drawDonut();
});

function syncInputs(){
  ['netWorth','monthlyIncome','monthlyExpenses','totalAssets','totalLiabilities'].forEach(k=>{
    const el=document.getElementById('f-'+k);if(el)el.value=D[k];
  });
}

// â”€â”€â”€ NAV â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function nav(id,btn){
  document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
  document.querySelectorAll('.nav-tab').forEach(t=>t.classList.remove('active'));
  document.getElementById('sec-'+id).classList.add('active');
  if(btn)btn.classList.add('active');
  setTimeout(()=>{
    if(id==='networth')   {drawNWT();drawAssetMix();}
    if(id==='budget')     {draw5030();drawProj();}
    if(id==='investments'){drawPort();drawSB();}
    if(id==='fire')       {drawFire();}
  },60);
}

// â”€â”€â”€ RECALC â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function recalc(){
  D.monthlyIncome   = +gi('f-income')      || D.monthlyIncome;
  D.monthlyExpenses = +gi('f-expenses')    || D.monthlyExpenses;
  D.totalAssets     = +gi('f-assets')      || D.totalAssets;
  D.totalLiabilities= +gi('f-liabilities') || D.totalLiabilities;
  D.netWorth = D.totalAssets - D.totalLiabilities;
  const nwEl=document.getElementById('f-netWorth');if(nwEl)nwEl.value=D.netWorth;

  const sav=D.monthlyIncome-D.monthlyExpenses;
  const savR=D.monthlyIncome>0?sav/D.monthlyIncome*100:0;
  const expR=D.monthlyIncome>0?D.monthlyExpenses/D.monthlyIncome*100:0;

  s('v-sav','$'+f(sav)); scl('v-sav','kpi-value '+(sav>=0?'green':'red'));
  s('d-savRate',(savR>=20?'â†‘':'â†’')+' '+savR.toFixed(1)+'% savings rate'); scl('d-savRate','kpi-delta '+(savR>=20?'up':savR>10?'dim':'down'));
  bw('b-sav',Math.min(100,savR));
  s('d-expRatio',expR.toFixed(1)+'% of income'); bw('b-exp',Math.min(100,expR));
  bw('b-nw',Math.min(100,D.netWorth/1000000*100));

  const annExp=D.monthlyExpenses*12, fireNum=annExp*25;
  const firePct=Math.min(100,D.netWorth/fireNum*100);
  const annSav=sav*12;
  const yrs=calcYearsToFI(D.netWorth,fireNum,annSav,D.fireReturn/100);

  s('v-firePct',firePct.toFixed(1)+'%');
  s('d-firePct','$'+f(D.netWorth)+' / $'+f(fireNum));
  bw('b-fire',firePct);
  s('v-yrs',isFinite(yrs)?yrs+' yrs':'âˆž');
  s('d-yrs',isFinite(yrs)?'FI in '+(new Date().getFullYear()+yrs):'boost savings rate');
  bw('b-yrs',Math.min(100,Math.max(0,(30-(isFinite(yrs)?yrs:30))/30*100)));

  s('navBadge',firePct<25?'Early Stage ðŸŒ±':firePct<50?'Building ðŸ”¨':firePct<75?'Coast FIRE ðŸ„':'Near FI ðŸ”¥');

  // 50/30/20
  const needs=D.spending.filter(x=>x.type==='need').reduce((a,b)=>a+b.amt,0);
  const wants=D.spending.filter(x=>x.type==='want').reduce((a,b)=>a+b.amt,0);
  const sd=D.monthlyIncome-needs-wants;
  const np=D.monthlyIncome>0?needs/D.monthlyIncome*100:0;
  const wp=D.monthlyIncome>0?wants/D.monthlyIncome*100:0;
  const sp=D.monthlyIncome>0?sd/D.monthlyIncome*100:0;
  s('v-needs','$'+f(needs)); s('d-needs',np.toFixed(1)+'%'+(np<=50?' âœ“':' â€” over 50%')); scl('d-needs','kpi-delta '+(np<=50?'up':'down')); bw('b-needs',np);
  s('v-wants','$'+f(wants)); s('d-wants',wp.toFixed(1)+'%'+(wp<=30?' âœ“':' â€” over 30%')); scl('d-wants','kpi-delta '+(wp<=30?'up':'down')); bw('b-wants',wp);
  s('v-sav2','$'+f(sd));    s('d-sav2', sp.toFixed(1)+'%'+(sp>=20?' âœ“':' â€” below 20%')); scl('d-sav2','kpi-delta '+(sp>=20?'up':'down')); bw('b-sav2',Math.min(100,sp));

  // Investments
  const ret=D.assets.filter(a=>a.cls==='Retirement').reduce((a,b)=>a+b.value,0);
  const tax=D.assets.filter(a=>a.cls==='Taxable').reduce((a,b)=>a+b.value,0);
  const pt=ret+tax;
  s('v-portTot','$'+f(pt)); s('d-portPct',(D.totalAssets>0?(pt/D.totalAssets*100).toFixed(0):0)+'% of assets');
  s('v-ret','$'+f(ret)); s('d-retPct',(pt>0?(ret/pt*100).toFixed(0):0)+'% of portfolio');
  s('v-tax','$'+f(tax));
  s('v-contrib','$'+f(annSav)); s('d-contrib',savR.toFixed(1)+'% savings rate');
  s('port-v','$'+f(pt)); s('am-v','$'+f(D.totalAssets));

  renderInsights(); renderFireKPIs(); renderFireAssumptions(); renderSavSc(); renderBudgetIns(); renderInvIns();
  renderStockBondIns(); renderLeanFat();
}

function calcYearsToFI(cur,target,annSav,r){
  if(annSav<=0)return Infinity;
  if(cur>=target)return 0;
  if(r===0)return Math.ceil((target-cur)/annSav);
  return Math.ceil(Math.log((target*r+annSav)/(cur*r+annSav))/Math.log(1+r));
}

// â”€â”€â”€ RENDER ALL â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderAll(){
  renderAssetsTable(); renderLiabTable(); renderCatBars(); renderMilestones();
  renderPAW(); renderPeer(); renderEmergency();
  renderTaxEff(); renderContribLim(); renderAllocLg();
  renderFireVariants(); renderLeanFat(); renderSavSc();
  renderBudgetIns(); renderInvIns(); renderInsights(); renderFireKPIs(); renderFireAssumptions();
  renderStockBondIns();
}

// â”€â”€â”€ CHARTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function dk(id){if(charts[id]){charts[id].destroy();delete charts[id];}}
function cx(id){return document.getElementById(id)?.getContext('2d');}

function drawIE(){
  dk('ie');const c=cx('ch-ie');if(!c)return;
  charts.ie=new Chart(c,{type:'bar',data:{labels:MOS,datasets:[
    {label:'Income',   data:D.incHistory,backgroundColor:'rgba(76,175,130,0.65)',borderColor:'#4caf82',borderWidth:1},
    {label:'Expenses', data:D.expHistory,backgroundColor:'rgba(224,90,78,0.55)', borderColor:'#e05a4e',borderWidth:1},
  ]},options:{...CD,responsive:true,maintainAspectRatio:false,
    plugins:{...CD.plugins,legend:{display:true,position:'top',labels:{font:{family:'JetBrains Mono',size:9},boxWidth:10,padding:14,color:'#888880'}}},
    scales:{x:{grid:{display:false},ticks:{font:{family:'JetBrains Mono',size:8},color:'#555550'}},
            y:{grid:{color:'rgba(255,255,255,0.04)'},ticks:{font:{family:'JetBrains Mono',size:8},color:'#555550',callback:v=>'$'+(v/1000).toFixed(0)+'k'}}}}});
}

function drawDonut(){
  dk('dd');const c=cx('ch-donut');if(!c)return;
  const tot=D.spending.reduce((a,b)=>a+b.amt,0);
  s('donut-v','$'+f(tot));
  charts.dd=new Chart(c,{type:'doughnut',data:{labels:D.spending.map(x=>x.cat),datasets:[{data:D.spending.map(x=>x.amt),backgroundColor:D.spending.map(x=>x.color),borderWidth:2,borderColor:'#191917',hoverOffset:5}]},options:{responsive:true,maintainAspectRatio:false,cutout:'70%',plugins:{...CD.plugins}}});
  const lg=document.getElementById('donut-lg');
  if(lg)lg.innerHTML=D.spending.slice(0,6).map(x=>`<div style="display:flex;align-items:center;gap:7px;margin-bottom:5px"><div style="width:7px;height:7px;background:${x.color};flex-shrink:0"></div><span style="font-size:9px;flex:1;color:var(--text-dim)">${x.cat}</span><span style="font-size:9px;color:var(--text-faint)">$${f(x.amt)}</span></div>`).join('');
}

function drawNWT(){
  dk('nwt');const c=cx('ch-nwt');if(!c)return;
  const annSav=(D.monthlyIncome-D.monthlyExpenses)*12;
  const proj=[]; let cur=D.netWorth;
  for(let i=0;i<=5;i++){proj.push(Math.round(cur));cur=cur*(1+D.fireReturn/100)+annSav;}
  charts.nwt=new Chart(c,{type:'line',data:{labels:[...MOS,...['1yr','2yr','3yr','4yr','5yr']],datasets:[
    {label:'History', data:[...D.nwHistory,...Array(5).fill(null)],borderColor:'#d4a843',backgroundColor:'rgba(212,168,67,0.07)',borderWidth:2,fill:true,tension:0.4,pointRadius:2,pointBackgroundColor:'#d4a843'},
    {label:'Projected',data:[...Array(11).fill(null),D.netWorth,...proj.slice(1)],borderColor:'#5b9bd5',backgroundColor:'rgba(91,155,213,0.05)',borderWidth:1.5,borderDash:[5,3],fill:true,tension:0.3,pointRadius:2,pointBackgroundColor:'#5b9bd5'},
  ]},options:{...CD,responsive:true,maintainAspectRatio:false,
    plugins:{...CD.plugins,legend:{display:true,position:'top',labels:{font:{family:'JetBrains Mono',size:9},boxWidth:10,padding:14,color:'#888880'}}},
    scales:{x:{grid:{display:false},ticks:{font:{family:'JetBrains Mono',size:8},color:'#555550'}},
            y:{grid:{color:'rgba(255,255,255,0.04)'},ticks:{font:{family:'JetBrains Mono',size:8},color:'#555550',callback:v=>'$'+(v/1000).toFixed(0)+'k'}}}}});
}

function drawAssetMix(){
  dk('am');const c=cx('ch-assetmix');if(!c)return;
  const by={};D.assets.forEach(a=>{by[a.cls]=(by[a.cls]||0)+a.value;});
  charts.am=new Chart(c,{type:'doughnut',data:{labels:Object.keys(by),datasets:[{data:Object.values(by),backgroundColor:Object.keys(by).map(k=>ACLS[k]||'#555'),borderWidth:2,borderColor:'#191917',hoverOffset:5}]},options:{responsive:true,maintainAspectRatio:false,cutout:'65%',plugins:{...CD.plugins}}});
  const lg=document.getElementById('am-lg');
  if(lg)lg.innerHTML=Object.entries(by).map(([k,v])=>`<div class="alloc-row"><div class="alloc-dot" style="background:${ACLS[k]||'#555'}"></div><span class="alloc-name">${k}</span><span class="alloc-val">$${f(v)}</span></div>`).join('');
}

function draw5030(){
  dk('5030');const c=cx('ch-5030');if(!c)return;
  const inc=D.monthlyIncome;
  const needs=D.spending.filter(x=>x.type==='need').reduce((a,b)=>a+b.amt,0);
  const wants=D.spending.filter(x=>x.type==='want').reduce((a,b)=>a+b.amt,0);
  const sd=inc-needs-wants;
  charts['5030']=new Chart(c,{type:'bar',data:{labels:['Needs','Wants','Savings'],datasets:[
    {label:'Actual %',data:[inc>0?needs/inc*100:0,inc>0?wants/inc*100:0,inc>0?sd/inc*100:0],backgroundColor:['rgba(91,155,213,0.75)','rgba(212,168,67,0.75)','rgba(76,175,130,0.75)'],borderWidth:1,borderColor:['#5b9bd5','#d4a843','#4caf82']},
    {label:'Target %',data:[50,30,20],backgroundColor:'transparent',borderWidth:1.5,borderDash:[4,3],borderColor:['rgba(91,155,213,0.4)','rgba(212,168,67,0.4)','rgba(76,175,130,0.4)']},
  ]},options:{...CD,responsive:true,maintainAspectRatio:false,
    plugins:{...CD.plugins,legend:{display:true,position:'top',labels:{font:{family:'JetBrains Mono',size:9},boxWidth:10,padding:12,color:'#888880'}},
    tooltip:{...CD.plugins.tooltip,callbacks:{label:ctx=>ctx.dataset.label+': '+ctx.parsed.y.toFixed(1)+'%'}}},
    scales:{x:{grid:{display:false},ticks:{font:{family:'JetBrains Mono',size:9},color:'#555550'}},
            y:{max:65,grid:{color:'rgba(255,255,255,0.04)'},ticks:{callback:v=>v+'%',font:{family:'JetBrains Mono',size:9},color:'#555550'}}}}});
}

function drawProj(){
  dk('proj');const c=cx('ch-proj');if(!c)return;
  const annSav=(D.monthlyIncome-D.monthlyExpenses)*12;
  const r=D.fireReturn/100;
  const fireNum=D.monthlyExpenses*12*25;
  const yrs=Array.from({length:11},(_,i)=>i);
  const wr=yrs.map(y=>Math.round(D.netWorth*Math.pow(1+r,y)+annSav*((Math.pow(1+r,y)-1)/r)));
  const nr=yrs.map(y=>Math.round(D.netWorth+annSav*y));
  charts.proj=new Chart(c,{type:'line',data:{labels:yrs.map(y=>'Yr '+y),datasets:[
    {label:'With '+D.fireReturn+'% Returns',data:wr,borderColor:'#d4a843',backgroundColor:'rgba(212,168,67,0.07)',borderWidth:2.5,fill:true,tension:0.4,pointRadius:2.5,pointBackgroundColor:'#d4a843'},
    {label:'Savings Only',data:nr,borderColor:'#5b9bd5',backgroundColor:'transparent',borderWidth:1.5,borderDash:[5,3],tension:0.3,pointRadius:2},
    {label:'FIRE Target',data:yrs.map(()=>fireNum),borderColor:'rgba(224,90,78,0.5)',backgroundColor:'transparent',borderWidth:1,borderDash:[2,4],pointRadius:0},
  ]},options:{...CD,responsive:true,maintainAspectRatio:false,
    plugins:{...CD.plugins,legend:{display:true,position:'top',labels:{font:{family:'JetBrains Mono',size:9},boxWidth:10,padding:12,color:'#888880'}},
    tooltip:{...CD.plugins.tooltip,callbacks:{label:ctx=>ctx.dataset.label+': $'+f(ctx.parsed.y)}}},
    scales:{x:{grid:{display:false},ticks:{font:{family:'JetBrains Mono',size:8},color:'#555550'}},
            y:{grid:{color:'rgba(255,255,255,0.04)'},ticks:{callback:v=>'$'+(v/1000).toFixed(0)+'k',font:{family:'JetBrains Mono',size:8},color:'#555550'}}}}});
}

function drawPort(){
  dk('port');const c=cx('ch-port');if(!c)return;
  charts.port=new Chart(c,{type:'doughnut',data:{labels:D.portfolio.map(p=>p.label),datasets:[{data:D.portfolio.map(p=>p.value),backgroundColor:D.portfolio.map(p=>p.color),borderWidth:2,borderColor:'#191917',hoverOffset:5}]},options:{responsive:true,maintainAspectRatio:false,cutout:'68%',plugins:{...CD.plugins}}});
  renderAllocLg();
}

function drawSB(){
  dk('sb');const c=cx('ch-sb');if(!c)return;
  const tot=D.portfolio.reduce((a,b)=>a+b.value,0);
  const us=D.portfolio.filter(p=>p.label.includes('Stock')).reduce((a,b)=>a+b.value,0);
  const intl=D.portfolio.filter(p=>p.label.includes('Intl')||p.label.includes('International')).reduce((a,b)=>a+b.value,0);
  const bonds=D.portfolio.filter(p=>p.label.includes('Bond')).reduce((a,b)=>a+b.value,0);
  const other=tot-us-intl-bonds;
  charts.sb=new Chart(c,{type:'bar',data:{labels:['US Equities','International','Bonds','Other'],datasets:[
    {label:'Your Alloc',data:[tot>0?us/tot*100:0,tot>0?intl/tot*100:0,tot>0?bonds/tot*100:0,tot>0?other/tot*100:0],backgroundColor:['rgba(91,155,213,0.7)','rgba(155,127,232,0.7)','rgba(212,168,67,0.7)','rgba(76,175,130,0.7)'],borderWidth:1},
    {label:'FIRE Target',data:[60,20,15,5],backgroundColor:'transparent',borderWidth:1.5,borderDash:[4,3],borderColor:'rgba(255,255,255,0.2)'},
  ]},options:{...CD,responsive:true,maintainAspectRatio:false,
    plugins:{...CD.plugins,legend:{display:true,position:'top',labels:{font:{family:'JetBrains Mono',size:9},boxWidth:10,padding:12,color:'#888880'}},
    tooltip:{...CD.plugins.tooltip,callbacks:{label:ctx=>ctx.dataset.label+': '+ctx.parsed.y.toFixed(1)+'%'}}},
    scales:{x:{grid:{display:false},ticks:{font:{family:'JetBrains Mono',size:8},color:'#555550'}},
            y:{max:80,grid:{color:'rgba(255,255,255,0.04)'},ticks:{callback:v=>v+'%',font:{family:'JetBrains Mono',size:8},color:'#555550'}}}}});
}

function drawFire(){
  dk('fire');const c=cx('ch-fire');if(!c)return;
  const fireNum=D.monthlyExpenses*12*25;
  const r=D.fireReturn/100;
  const annSav=(D.monthlyIncome-D.monthlyExpenses)*12;
  const scen=[
    {label:'Current rate',         sav:annSav,                              color:'#d4a843'},
    {label:'Save 5% more',         sav:annSav+D.monthlyIncome*0.05*12,      color:'#5b9bd5'},
    {label:'Save 10% more',        sav:annSav+D.monthlyIncome*0.10*12,      color:'#4caf82'},
    {label:'Cut expenses 15%',     sav:D.monthlyIncome*12-D.monthlyExpenses*0.85*12, color:'#9b7fe8'},
  ];
  const yrs=Array.from({length:31},(_,i)=>i);
  charts.fire=new Chart(c,{type:'line',data:{labels:yrs.map(y=>'Yr '+y),datasets:[
    ...scen.map(sc=>({label:sc.label,data:yrs.map(y=>Math.min(Math.round(D.netWorth*Math.pow(1+r,y)+sc.sav*((Math.pow(1+r,y)-1)/r)),fireNum*1.1)),borderColor:sc.color,backgroundColor:'transparent',borderWidth:2,tension:0.3,pointRadius:0})),
    {label:'FIRE Target',data:yrs.map(()=>fireNum),borderColor:'rgba(224,90,78,0.6)',backgroundColor:'rgba(224,90,78,0.03)',borderWidth:1.2,borderDash:[3,4],pointRadius:0,fill:true},
  ]},options:{...CD,responsive:true,maintainAspectRatio:false,
    plugins:{...CD.plugins,legend:{display:true,position:'top',labels:{font:{family:'JetBrains Mono',size:9},boxWidth:10,padding:14,color:'#888880'}},
    tooltip:{...CD.plugins.tooltip,callbacks:{label:ctx=>ctx.dataset.label+': $'+f(ctx.parsed.y)}}},
    scales:{x:{grid:{display:false},ticks:{font:{family:'JetBrains Mono',size:8},color:'#555550'}},
            y:{grid:{color:'rgba(255,255,255,0.04)'},ticks:{callback:v=>'$'+(v/1000).toFixed(0)+'k',font:{family:'JetBrains Mono',size:8},color:'#555550'}}}}});
}

// â”€â”€â”€ RENDER COMPONENTS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function renderAssetsTable(){
  const tb=document.getElementById('tbl-a');if(!tb)return;
  const tot=D.assets.reduce((a,b)=>a+b.value,0);
  const clsTag={Retirement:'tg',Taxable:'bg',Cash:'gg',Property:'pg',Alt:'rg'};
  tb.innerHTML=D.assets.map(a=>`<tr><td>${a.name}</td><td class="pos" style="text-align:right">$${f(a.value)}</td><td style="text-align:right"><span class="tag ${clsTag[a.cls]||'tg'}">${a.cls}</span></td></tr>`).join('')
    +`<tr style="border-top:1px solid var(--border2)"><td style="font-size:10px;color:var(--text-dim)">Total Assets</td><td class="pos" style="text-align:right;font-size:12px">$${f(tot)}</td><td></td></tr>`;
}

function renderLiabTable(){
  const tb=document.getElementById('tbl-l');if(!tb)return;
  const sorted=[...D.liabilities].sort((a,b)=>b.rate-a.rate);
  const tot=sorted.reduce((a,b)=>a+b.balance,0);
  tb.innerHTML=sorted.map((l,i)=>`<tr><td>${l.name}</td><td class="neg" style="text-align:right">$${f(l.balance)}</td><td style="text-align:right"><span class="tag ${l.rate>15?'rg':l.rate>8?'tg':'gg'}">${l.rate}%</span></td><td style="text-align:right"><span class="tag ${i===0?'rg':i===1?'tg':'bg'}">#${i+1}</span></td></tr>`).join('')
    +`<tr style="border-top:1px solid var(--border2)"><td style="font-size:10px;color:var(--text-dim)">Total</td><td class="neg" style="text-align:right;font-size:12px">$${f(tot)}</td><td></td><td></td></tr>`;
}

function renderCatBars(){
  const el=document.getElementById('cat-bars');if(!el)return;
  const inc=D.monthlyIncome;
  el.innerHTML=D.spending.map(x=>{
    const p=inc>0?x.amt/inc*100:0;
    return `<div class="prog"><div class="prog-row"><span class="prog-name">${x.cat} <span class="tag ${x.type==='need'?'bg':'tg'}" style="margin-left:4px">${x.type}</span></span><span class="prog-val">$${f(x.amt)} Â· ${p.toFixed(1)}%</span></div><div class="prog-track"><div class="prog-fill" style="width:${Math.min(100,p)}%;background:${x.color}"></div></div></div>`;
  }).join('');
}

function renderMilestones(){
  const el=document.getElementById('milestones');if(!el)return;
  const fireNum=D.monthlyExpenses*12*25;
  const ms=[
    {label:'3-Mo Emergency Fund',  target:D.monthlyExpenses*3,   cur:D.emergencyFund, color:'var(--green)'},
    {label:'6-Mo Emergency Fund',  target:D.monthlyExpenses*6,   cur:D.emergencyFund, color:'var(--green)'},
    {label:'$100k Net Worth',       target:100000, cur:D.netWorth, color:'var(--gold)'},
    {label:'$250k Net Worth',       target:250000, cur:D.netWorth, color:'var(--gold)'},
    {label:'$500k â€” Half-FI',       target:500000, cur:D.netWorth, color:'var(--blue)'},
    {label:'$1M â€” FI Threshold',    target:1000000,cur:D.netWorth, color:'var(--purple)'},
    {label:'FIRE Number (25Ã— exp)', target:fireNum, cur:D.netWorth, color:'var(--red)'},
  ];
  el.innerHTML=ms.map(m=>{
    const p=Math.min(100,m.cur/m.target*100), done=p>=100;
    return `<div class="ms"><div class="ms-hdr"><span class="ms-label">${m.label}${done?' <span style="color:var(--green)">âœ“</span>':''}</span><span class="ms-meta">$${f(Math.min(m.cur,m.target))} / $${f(m.target)} Â· ${p.toFixed(1)}%</span></div><div class="ms-track"><div class="ms-fill" style="width:${p}%;background:${done?'var(--green)':m.color}"></div></div></div>`;
  }).join('');
}

function renderPAW(){
  const el=document.getElementById('paw');if(!el)return;
  const exp=D.age*D.grossIncome/10, ratio=D.netWorth/exp;
  const label=ratio>=2?'PAW â€” Prodigious':ratio>=1?'AAW â€” Average':'UAW â€” Under-Acc.';
  const col=ratio>=2?'var(--green)':ratio>=1?'var(--gold)':'var(--red)';
  el.innerHTML=`<div style="font-family:'Cormorant Garamond',serif;font-size:40px;font-weight:700;color:${col};line-height:1;margin:14px 0 8px">${ratio.toFixed(2)}Ã—</div>
    <span class="tag ${ratio>=2?'gg':ratio>=1?'tg':'rg'}">${label}</span>
    <div style="margin-top:12px;font-size:10px;color:var(--text-dim);line-height:1.65">Expected: Age ${D.age} Ã— $${f(D.grossIncome)} Ã· 10 = <strong style="color:var(--text)">$${f(exp)}</strong><br>Your NW: <strong style="color:${col}">$${f(D.netWorth)}</strong></div>
    <div class="prog-track" style="margin-top:12px"><div class="prog-fill" style="width:${Math.min(100,ratio/2*100)}%;background:${col}"></div></div>
    <div style="font-size:8px;color:var(--text-faint);margin-top:4px">0 â†’ UAW &nbsp;Â·&nbsp; 1Ã— â†’ AAW &nbsp;Â·&nbsp; 2Ã— â†’ PAW</div>`;
}

function renderPeer(){
  const el=document.getElementById('peer');if(!el)return;
  const b={p50:90000,p75:250000,p90:500000};
  const tier=D.netWorth>=b.p90?'Top 10%':D.netWorth>=b.p75?'Top 25%':D.netWorth>=b.p50?'Above Median':'Below Median';
  const col=D.netWorth>=b.p75?'var(--green)':D.netWorth>=b.p50?'var(--gold)':'var(--red)';
  el.innerHTML=`<div style="margin-top:8px"><span class="tag ${D.netWorth>=b.p75?'gg':D.netWorth>=b.p50?'tg':'rg'}">${tier} for Age ~${D.age}</span></div>`
    +[['Median',b.p50,'var(--text-dim)'],[' 75th',b.p75,'var(--blue)'],['Top 10%',b.p90,'var(--green)']].map(([l,v,c])=>
    `<div class="prog" style="margin-top:12px"><div class="prog-row"><span class="prog-name" style="color:${c}">${l}</span><span class="prog-val">$${f(v)}</span></div><div class="prog-track"><div class="prog-fill" style="width:${Math.min(100,D.netWorth/v*100)}%;background:${c}"></div></div></div>`).join('')
    +`<div style="margin-top:8px;font-size:8px;color:var(--text-faint)">Source: Federal Reserve SCF 2022 Â· Age ~35</div>`;
}

function renderEmergency(){
  const el=document.getElementById('emergency');if(!el)return;
  const mo=D.monthlyExpenses>0?D.emergencyFund/D.monthlyExpenses:0, ok=mo>=3;
  el.innerHTML=`<div style="font-family:'Cormorant Garamond',serif;font-size:40px;font-weight:700;color:${ok?'var(--green)':'var(--red)'};line-height:1;margin:14px 0 8px">${mo.toFixed(1)} mo</div>
    <span class="tag ${ok?'gg':'rg'}">${ok?'Adequate':'Insufficient'}</span>
    <div style="margin-top:12px">`
    +[['3 months (min)',3],['6 months (ideal)',6]].map(([l,t])=>{const p=Math.min(100,mo/t*100);return `<div class="prog"><div class="prog-row"><span class="prog-name">${l}</span><span class="prog-val">${p.toFixed(0)}%</span></div><div class="prog-track"><div class="prog-fill" style="width:${p}%;background:${p>=100?'var(--green)':'var(--gold)'}"></div></div></div>`;}).join('')
    +`</div><div style="margin-top:8px;font-size:9px;color:var(--text-faint)">HYSA $${f(D.emergencyFund)} Â· $${f(D.monthlyExpenses)}/mo expenses</div>`;
}

function renderTaxEff(){
  const el=document.getElementById('tax-eff');if(!el)return;
  const ret=D.assets.filter(a=>a.cls==='Retirement').reduce((a,b)=>a+b.value,0);
  const steps=[
    {n:1,label:'401(k) to Employer Match',  done:ret>0,   note:'100% instant return. Never skip.'},
    {n:2,label:'HSA (if eligible)',          done:false,   note:'Triple tax advantage. Best account.'},
    {n:3,label:'Roth IRA ($7,000 limit)',    done:ret>5000,note:'Tax-free growth. Use if income <$161k.'},
    {n:4,label:'401(k) to Max ($23,000)',    done:ret>30000,note:'$23k limit (2024). Max if possible.'},
    {n:5,label:'Taxable Brokerage',          done:D.assets.find(a=>a.cls==='Taxable')?.value>0,note:'After maxing tax-advantaged space.'},
  ];
  el.innerHTML=`<div style="margin-top:4px">`+steps.map(s=>`<div style="display:flex;gap:10px;align-items:flex-start;margin-bottom:12px"><div style="width:20px;height:20px;flex-shrink:0;border:1px solid ${s.done?'var(--green)':'var(--border2)'};background:${s.done?'var(--green-dim)':'transparent'};display:flex;align-items:center;justify-content:center;font-size:9px;color:${s.done?'var(--green)':'var(--text-faint)'}">${s.done?'âœ“':s.n}</div><div><div style="font-size:10px;color:${s.done?'var(--text)':'var(--text-dim)'}">${s.label}</div><div style="font-size:9px;color:var(--text-faint);margin-top:2px">${s.note}</div></div></div>`).join('')+`</div>`;
}

function renderContribLim(){
  const el=document.getElementById('contrib-lim');if(!el)return;
  const lim=[
    {acct:'401(k)',    limit:23000, est:D.grossIncome*0.10, col:'var(--gold)'},
    {acct:'Roth IRA',  limit:7000,  est:D.grossIncome*0.04, col:'var(--purple)'},
    {acct:'HSA',       limit:4150,  est:0,                   col:'var(--green)'},
  ];
  el.innerHTML=`<div style="margin-top:8px">`+lim.map(l=>{const p=Math.min(100,l.est/l.limit*100),room=Math.max(0,l.limit-l.est);return `<div class="prog" style="margin-top:14px"><div class="prog-row"><span class="prog-name" style="color:${l.col}">${l.acct} (max $${f(l.limit)})</span><span class="prog-val">$${f(room)} unused</span></div><div class="prog-track"><div class="prog-fill" style="width:${p}%;background:${l.col}"></div></div></div>`;}).join('')
  +`<div style="margin-top:12px;font-size:9px;color:var(--text-faint)">Estimated from $${f(D.grossIncome)} gross income Â· update via edit mode</div></div>`;
}

function renderAllocLg(){
  const el=document.getElementById('alloc-lg');if(!el)return;
  const tot=D.portfolio.reduce((a,b)=>a+b.value,0);
  el.innerHTML=D.portfolio.map(p=>`<div class="alloc-row"><div class="alloc-dot" style="background:${p.color}"></div><span class="alloc-name">${p.label}</span><span class="alloc-pct">${tot>0?(p.value/tot*100).toFixed(0):0}%</span><span class="alloc-val">$${f(p.value)}</span></div>`).join('');
}

function renderStockBondIns(){
  const el=document.getElementById('sb-ins');if(!el)return;
  const targetEq=Math.min(90,110-D.age);
  const tot=D.portfolio.reduce((a,b)=>a+b.value,0);
  const actEq=tot>0?D.portfolio.filter(p=>!p.label.includes('Bond')).reduce((a,b)=>a+b.value,0)/tot*100:0;
  const diff=actEq-targetEq;
  el.innerHTML=`<div class="ins ${Math.abs(diff)<5?'igg':'ig'}"><div class="ins-h">${Math.abs(diff)<5?'âœ“ Well Balanced':'âš¡ Rebalancing Signal'}</div><div class="ins-p">FIRE target: 110 âˆ’ ${D.age} = <strong>${targetEq}%</strong> equity. Actual: <strong>${actEq.toFixed(0)}%</strong>. ${Math.abs(diff)<5?'On track.':diff>0?`Shift ${diff.toFixed(0)}% toward bonds/fixed income.`:`Shift ${Math.abs(diff).toFixed(0)}% toward equities.`}</div></div>`;
}

function renderFireKPIs(){
  const el=document.getElementById('fire-kpis');if(!el)return;
  const fireNum=D.monthlyExpenses*12*25;
  const firePct=Math.min(100,D.netWorth/fireNum*100);
  const yrs=calcYearsToFI(D.netWorth,fireNum,(D.monthlyIncome-D.monthlyExpenses)*12,D.fireReturn/100);
  el.innerHTML=[
    {label:'FIRE Number',  val:'$'+f(fireNum), sub:'25Ã— annual expenses',  col:'var(--gold)'},
    {label:'Current NW',   val:'$'+f(D.netWorth),sub:firePct.toFixed(1)+'% there', col:'var(--text)'},
    {label:'Years to FI',  val:isFinite(yrs)?yrs:'âˆž', sub:isFinite(yrs)?'FI in '+(new Date().getFullYear()+yrs):'boost savings', col:isFinite(yrs)&&yrs<20?'var(--green)':'var(--red)'},
  ].map(k=>`<div style="text-align:center;padding:14px;background:var(--surface2);border:1px solid var(--border)"><div style="font-size:8px;letter-spacing:0.2em;text-transform:uppercase;color:var(--text-faint);margin-bottom:8px">${k.label}</div><div style="font-family:'Cormorant Garamond',serif;font-size:26px;font-weight:700;color:${k.col};line-height:1">${k.val}</div><div style="font-size:9px;color:var(--text-faint);margin-top:6px">${k.sub}</div></div>`).join('');
  const needle=document.getElementById('fire-needle');
  if(needle)setTimeout(()=>{needle.style.left=Math.min(97,Math.max(2,firePct))+'%';},100);
}

function renderFireAssumptions(){
  const el=document.getElementById('fire-assumptions');if(!el)return;
  const sav=D.monthlyIncome-D.monthlyExpenses;
  el.innerHTML=[
    {l:'Expected Return',    v:D.fireReturn+'%',          n:'Historical S&P 500 real avg'},
    {l:'Withdrawal Rate',    v:D.fireWithdrawal+'%',       n:'Bengen 4% rule (Trinity)'},
    {l:'Current Age',        v:D.age,                     n:'Mid-career phase'},
    {l:'Annual Expenses',    v:'$'+f(D.monthlyExpenses*12),n:'$'+f(D.monthlyExpenses)+'/mo'},
    {l:'Annual Savings',     v:'$'+f(sav*12),              n:((sav/D.monthlyIncome)*100).toFixed(1)+'% rate'},
  ].map(a=>`<div style="display:flex;justify-content:space-between;align-items:flex-start;padding:10px 0;border-bottom:1px solid var(--border)"><div><div style="font-size:10px;color:var(--text-dim)">${a.l}</div><div style="font-size:9px;color:var(--text-faint);margin-top:2px">${a.n}</div></div><div style="font-family:'Cormorant Garamond',serif;font-size:17px;font-weight:600;color:var(--gold)">${a.v}</div></div>`).join('');
}

function renderFireVariants(){
  const el=document.getElementById('fire-variants');if(!el)return;
  el.innerHTML=[
    {name:'Lean FIRE',  mul:20, desc:'Frugal lifestyle, earliest exit. Tight budget required.'},
    {name:'Regular FIRE',mul:25,desc:'4% rule baseline. Maintain current expense level.'},
    {name:'Fat FIRE',   mul:33, desc:'3% withdrawal. Elevated lifestyle. Maximum buffer.'},
    {name:'Coast FIRE', mul:25, desc:'Stop contributing â€” compounding covers the rest.'},
    {name:'Barista FIRE',mul:25,desc:'Part-time covers expenses; portfolio stays intact.'},
  ].map(v=>`<div style="padding:10px 0;border-bottom:1px solid var(--border)"><div style="display:flex;justify-content:space-between;margin-bottom:3px"><span style="font-size:10px;color:var(--text)">${v.name}</span><span style="font-family:'Cormorant Garamond',serif;font-size:14px;color:var(--gold)">$${f(D.monthlyExpenses*12*v.mul)}</span></div><div style="font-size:9px;color:var(--text-faint)">${v.desc}</div></div>`).join('');
}

function renderLeanFat(){
  const lEl=document.getElementById('lean-fire'), fEl=document.getElementById('fat-fire');
  const sav=(D.monthlyIncome-D.monthlyExpenses)*12, r=D.fireReturn/100;
  if(lEl){
    const lNum=D.monthlyExpenses*0.7*12*25, lYrs=calcYearsToFI(D.netWorth,lNum,sav,r), lPct=Math.min(100,D.netWorth/lNum*100);
    lEl.innerHTML=`<div style="margin-top:8px;font-size:9px;color:var(--text-faint)">Expenses âˆ’30% â†’ $${f(D.monthlyExpenses*0.7*12)}/yr</div><div style="font-family:'Cormorant Garamond',serif;font-size:36px;font-weight:700;color:var(--green);margin:12px 0 4px">${isFinite(lYrs)?lYrs+' yrs':'âˆž'}</div><div style="font-size:9px;color:var(--text-faint)">Target: $${f(lNum)}</div><div class="prog-track" style="margin-top:10px"><div class="prog-fill" style="width:${lPct}%;background:var(--green)"></div></div><div style="font-size:9px;color:var(--text-dim);margin-top:5px">${lPct.toFixed(1)}% there</div><div class="ins igg" style="margin-top:12px"><div class="ins-p">Earliest exit date. Trade-off: less buffer for healthcare & unexpected costs in early retirement.</div></div>`;
  }
  if(fEl){
    const fNum=D.monthlyExpenses*1.5*12*33, fYrs=calcYearsToFI(D.netWorth,fNum,sav,r), fPct=Math.min(100,D.netWorth/fNum*100);
    fEl.innerHTML=`<div style="margin-top:8px;font-size:9px;color:var(--text-faint)">Expenses +50% â†’ $${f(D.monthlyExpenses*1.5*12)}/yr Â· 3% SWR</div><div style="font-family:'Cormorant Garamond',serif;font-size:36px;font-weight:700;color:var(--gold);margin:12px 0 4px">${isFinite(fYrs)?fYrs+' yrs':'âˆž'}</div><div style="font-size:9px;color:var(--text-faint)">Target: $${f(fNum)}</div><div class="prog-track" style="margin-top:10px"><div class="prog-fill" style="width:${fPct}%;background:var(--gold)"></div></div><div style="font-size:9px;color:var(--text-dim);margin-top:5px">${fPct.toFixed(1)}% there</div><div class="ins ig" style="margin-top:12px"><div class="ins-p">Maximum lifestyle freedom + sequence-of-returns buffer. Significantly larger number required.</div></div>`;
  }
}

function renderSavSc(){
  const el=document.getElementById('sav-sc');if(!el)return;
  const fireNum=D.monthlyExpenses*12*25, r=D.fireReturn/100;
  const curr=(D.monthlyIncome-D.monthlyExpenses)*12;
  const rows=[0,5,10,15,20].map((ex,i)=>{
    const sav=curr+D.monthlyIncome*ex/100*12;
    const yrs=calcYearsToFI(D.netWorth,fireNum,sav,r);
    return {ex,sav,yrs,i};
  });
  el.innerHTML=`<table class="tbl"><thead><tr><th>Savings Boost</th><th style="text-align:right">Added/yr</th><th style="text-align:right">FI Timeline</th></tr></thead><tbody>`
    +rows.map(({ex,sav,yrs,i})=>`<tr><td style="color:${i===0?'var(--text-dim)':'var(--text)'}">+${ex}%${i===0?' (current)':''}</td><td style="text-align:right;color:var(--green)">+$${f(D.monthlyIncome*ex/100*12)}</td><td style="text-align:right;color:${i===0?'var(--text-dim)':'var(--gold)'};">${isFinite(yrs)?yrs+' yrs':'âˆž'}</td></tr>`).join('')
    +`</tbody></table><div style="margin-top:12px;font-size:9px;color:var(--text-faint)">Assumes ${D.fireReturn}% real return. Each 5% boost = years shaved.</div>`;
}

function renderBudgetIns(){
  const el=document.getElementById('budget-ins');if(!el)return;
  const top=[...D.spending].filter(x=>x.type==='want').sort((a,b)=>b.amt-a.amt)[0];
  const wPct=D.monthlyIncome>0?D.spending.filter(x=>x.type==='want').reduce((a,b)=>a+b.amt,0)/D.monthlyIncome*100:0;
  el.innerHTML=`<div class="ins ${wPct<=30?'igg':'ig'}"><div class="ins-h">${wPct<=30?'âœ“ Wants within target':'âš¡ Biggest compression opportunity'}</div><div class="ins-p">Top want: <strong>${top?.cat}</strong> at $${top?.amt}/mo. Cutting 25% = $${f((top?.amt||0)*0.25*12)}/yr. Invested at 7%: <strong>$${f((top?.amt||0)*0.25*12*14.8)}</strong> in 10 years.</div></div>`;
}

function renderInvIns(){
  const el=document.getElementById('inv-ins');if(!el)return;
  const high=D.liabilities.filter(l=>l.rate>10).reduce((a,b)=>a+b.balance,0);
  const ret=D.assets.filter(a=>a.cls==='Retirement').reduce((a,b)=>a+b.value,0);
  const ins=[];
  if(high>0)ins.push({cls:'ir',h:'ðŸ”¥ #1 Priority: Eliminate High-APR Debt',p:`$${f(high)} at 10%+ APR. Paying this off is a guaranteed ${D.liabilities.sort((a,b)=>b.rate-a.rate)[0]?.rate}% return â€” better than market expectations. Avalanche: attack Credit Card first.`});
  if(ret<23000)ins.push({cls:'ig',h:'ðŸ“‹ Maximize 401(k) Contributions',p:`Potential unused 401(k) space (2024 limit: $23,000). Each pre-tax dollar saves 25â€“37% immediately depending on your bracket.`});
  ins.push({cls:'ib',h:'ðŸŒ International Diversification',p:`If US equities exceed 70% of portfolio, add international exposure (VXUS/IXUS). Bogle's target: 20â€“30% international for diversification benefit.`});
  ins.push({cls:'ip',h:'ðŸ“Š Annual Rebalancing',p:`Set a calendar reminder to rebalance when any asset class drifts 5%+ from target. Tax-loss harvest in taxable brokerage during market downturns.`});
  ins.push({cls:'igg',h:'âœ“ Keep Expense Ratios Below 0.20%',p:`Vanguard/Fidelity index funds (VTI, VXUS, BND, FZROX) cost near 0%. A 1% fee difference costs ~28% of terminal wealth over 30 years (Bogle).`});
  el.innerHTML=ins.map(i=>`<div class="ins ${i.cls}"><div class="ins-h">${i.h}</div><div class="ins-p">${i.p}</div></div>`).join('');
}

function renderInsights(){
  const el=document.getElementById('insights');if(!el)return;
  const inc=D.monthlyIncome, exp=D.monthlyExpenses;
  const sav=inc-exp, savR=inc>0?sav/inc*100:0;
  const fireNum=exp*12*25, firePct=D.netWorth/fireNum*100;
  const yrs=calcYearsToFI(D.netWorth,fireNum,sav*12,D.fireReturn/100);
  const high=D.liabilities.filter(l=>l.rate>10);
  const ins=[];
  ins.push({cls:savR>=25?'igg':savR>=15?'ig':'ir',h:savR>=25?'ðŸŽ¯ Strong Savings Rate â€” FIRE on Track':savR>=15?'ðŸ“ˆ Good Start â€” Accelerate to Hit FIRE Faster':'âš ï¸ Savings Rate Needs Work',p:`At ${savR.toFixed(1)}%, you add $${f(sav*12)}/yr. ${savR>=25?'Top-tier accumulator pace. FI in ~'+yrs+' years.':savR>=15?'Each +5% ($'+f(inc*0.05*12)+'/yr) invested at 7% = $'+f(inc*0.05*12*14.8)+' in 10 years.':'Need $'+f(Math.max(0,inc*0.20-sav))+'/mo more to hit 20% target.'}`});
  if(high.length>0)ins.push({cls:'ir',h:'âš¡ High-APR Debt Blocks Wealth Accumulation',p:`$${f(high.reduce((a,b)=>a+b.balance,0))} at 10%+ APR (${high.map(d=>d.name).join(', ')}). Guaranteed ${high[0]?.rate}% return to pay off â€” beats expected ${D.fireReturn}% market return. Prioritize avalanche payoff.`});
  ins.push({cls:firePct>=25?'ig':firePct>=10?'ib':'ip',h:'ðŸ”¥ FIRE Progress: '+firePct.toFixed(1)+'%',p:`Target: $${f(fireNum)} (25Ã— annual expenses). At $${f(D.netWorth)}. ${isFinite(yrs)?`Trajectory: FI in ~${yrs} years (${new Date().getFullYear()+yrs}). Visit the FIRE tab for scenario modeling.`:'Increase savings rate to build a viable timeline.'}`});
  ins.push({cls:'ip',h:'ðŸ“Š Mid-Career Compounding Window',p:`$1 invested today at 7% â†’ $${Math.pow(1.07,25).toFixed(1)} in 25 years. Mid-career is your highest-value compounding window. Max tax-advantaged accounts first, then taxable brokerage.`});
  el.innerHTML=ins.map(i=>`<div class="ins ${i.cls}"><div class="ins-h">${i.h}</div><div class="ins-p">${i.p}</div></div>`).join('');
}

// â”€â”€â”€ EDIT MODE â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function toggleEdit(){
  editMode=!editMode;
  document.querySelectorAll('.kpi-input').forEach(el=>{el.readOnly=!editMode;});
  document.getElementById('editBtn').style.display=editMode?'none':'inline-block';
  document.getElementById('saveBtn').style.display=editMode?'inline-block':'none';
  document.getElementById('editBar').classList.toggle('show',editMode);
}

function saveAll(){
  recalc();
  try{localStorage.setItem('fd3',JSON.stringify(D));}catch(e){}
  document.getElementById('lastUp').textContent=new Date().toLocaleDateString('en-US',{month:'short',day:'numeric'});
  toggleEdit(); renderAll();
}

// â”€â”€â”€ UTILS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
function gi(id){const el=document.getElementById(id);return el?el.value:0;}
function s(id,h){const el=document.getElementById(id);if(el)el.innerHTML=h;}
function scl(id,c){const el=document.getElementById(id);if(el)el.className=c;}
function bw(id,p){const el=document.getElementById(id);if(el)el.style.width=Math.min(100,Math.max(0,p))+'%';}
function f(n){return Math.round(n).toLocaleString('en-US');}
function logout(){fetch('/auth/logout',{method:'POST'}).then(r=>r.json()).then(d=>window.location.href=d.redirect);}
</script>
</body>
</html>
